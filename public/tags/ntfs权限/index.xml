<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>NTFS权限 on 办公AI智能小助手</title>
        <link>http://localhost:1313/tags/ntfs%E6%9D%83%E9%99%90/</link>
        <description>Recent content in NTFS权限 on 办公AI智能小助手</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <copyright>qife</copyright>
        <lastBuildDate>Tue, 05 Aug 2025 21:55:36 +0800</lastBuildDate><atom:link href="http://localhost:1313/tags/ntfs%E6%9D%83%E9%99%90/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>如何利用薄弱的NTFS权限进行渗透测试</title>
        <link>http://localhost:1313/p/%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8%E8%96%84%E5%BC%B1%E7%9A%84ntfs%E6%9D%83%E9%99%90%E8%BF%9B%E8%A1%8C%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/</link>
        <pubDate>Tue, 05 Aug 2025 21:55:36 +0800</pubDate>
        
        <guid>http://localhost:1313/p/%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8%E8%96%84%E5%BC%B1%E7%9A%84ntfs%E6%9D%83%E9%99%90%E8%BF%9B%E8%A1%8C%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/</guid>
        <description>&lt;h1 id=&#34;如何利用薄弱的ntfs权限&#34;&gt;如何利用薄弱的NTFS权限
&lt;/h1&gt;&lt;p&gt;薄弱的NTFS权限可能导致目标环境中多种攻击，包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;访问敏感信息&lt;/li&gt;
&lt;li&gt;修改系统二进制文件和配置文件&lt;/li&gt;
&lt;li&gt;DLL劫持等&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这些是渗透测试人员通常会考虑的攻击方式。然而，当我们只有有限权限时，还有其他机会可以寻找，尤其是在权限提升或横向移动受到限制的环境中。&lt;/p&gt;
&lt;h2 id=&#34;方法适用场景&#34;&gt;方法适用场景
&lt;/h2&gt;&lt;p&gt;该方法适用于因补偿控制而导致权限提升或横向移动受限的环境。建议在使用此方法前，先尝试密码喷洒和使用PowerUp等工具进行主机评估。&lt;/p&gt;
&lt;h2 id=&#34;寻找敏感位置&#34;&gt;寻找敏感位置
&lt;/h2&gt;&lt;p&gt;我们需要在环境中寻找哪些类型的访问权限？在这种情况下，我们关注的是能够写入可能让其他用户（或扫描器）执行内容的位置。&lt;/p&gt;
&lt;p&gt;通常，我们会寻找用于漫游配置文件、文件夹重定向或用户主目录的共享。管理员配置这些解决方案是为了便于访问、备份个人用户内容以及支持远程访问和虚拟化。&lt;/p&gt;
&lt;h3 id=&#34;文件夹重定向&#34;&gt;文件夹重定向
&lt;/h3&gt;&lt;p&gt;文件夹重定向可以通过组策略配置。更多详情可参考：&lt;a class=&#34;link&#34; href=&#34;https://technet.microsoft.com/en-us/library/cc732275%28v=ws.11%29.aspx&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;微软Technet文档&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;漫游配置文件&#34;&gt;漫游配置文件
&lt;/h3&gt;&lt;p&gt;漫游配置文件可以在用户的Active Directory账户设置中配置。通常会指定一个网络共享来存储所有用户的配置文件信息。&lt;/p&gt;
&lt;p&gt;更多详情可参考：&lt;a class=&#34;link&#34; href=&#34;https://technet.microsoft.com/en-us/library/jj649079%28v=ws.11%29.aspx&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;微软Technet文档&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;主文件夹&#34;&gt;主文件夹
&lt;/h3&gt;&lt;p&gt;在同一对话框中，我们可以看到指定用户主文件夹的字段。主文件夹通常也是一个共享位置，但可能不包含我们攻击目标中的项目（如快捷方式或收藏夹），但如果具有写入权限，仍然是一个有价值的位置。&lt;/p&gt;
&lt;h2 id=&#34;定位敏感位置&#34;&gt;定位敏感位置
&lt;/h2&gt;&lt;p&gt;一旦进入环境，如何找到这些敏感位置？可以使用PowerView的&lt;code&gt;Get-UserProperties&lt;/code&gt;命令来查询&amp;quot;Profile Path&amp;quot;和&amp;quot;Home Folder&amp;quot;属性。&lt;/p&gt;
&lt;p&gt;定位用于文件夹重定向的共享文件夹更为困难。需要搜索SYSVOL共享以查找文件夹重定向策略，除非使用的用户账户已应用文件夹重定向。此时，可以检查相关INI文件以确定文件夹重定向目标。&lt;/p&gt;
&lt;p&gt;使用PowerView的&lt;code&gt;Invoke-ShareFinder&lt;/code&gt;命令（带&lt;code&gt;CheckShareAccess&lt;/code&gt;开关）或类似工具可以确定可访问文件夹的位置。使用方法可参考以下博客：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.harmj0y.net/blog/powershell/veil-powerview-a-usage-guide/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Veil PowerView使用指南&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.veil-framework.com/hunting-sensitive-data-veil-framework/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;使用Veil框架狩猎敏感数据&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;执行攻击&#34;&gt;执行攻击
&lt;/h2&gt;&lt;p&gt;找到可写位置后，可以执行哪些攻击？一些明显的攻击包括修改&amp;quot;My Documents&amp;quot;文件夹中的常用文件，例如添加恶意宏（如unicorn.py生成的PowerShell宏）。&lt;/p&gt;
&lt;p&gt;或者，可以使用msfvenom等工具后门现有可执行文件，如&lt;a class=&#34;link&#34; href=&#34;https://www.offensive-security.com/metasploit-unleashed/backdooring-exe-files/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Offensive Security文档&lt;/a&gt;所述。&lt;/p&gt;
&lt;p&gt;这两种方法都希望用户执行内容，从而在环境中获得额外的会话和扩展访问权限。&lt;/p&gt;
&lt;h2 id=&#34;使用metasploit捕获smb哈希&#34;&gt;使用Metasploit捕获SMB哈希
&lt;/h2&gt;&lt;p&gt;我们将探索另一种方法：使用Metasploit的&lt;code&gt;auxiliary/server/capture/smb&lt;/code&gt;模块。该模块用于通过恶意SMB服务器收集哈希以进行破解。&lt;/p&gt;
&lt;p&gt;模块选项包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;SRVHOST&lt;/code&gt;和&lt;code&gt;SRVPORT&lt;/code&gt;：设置服务器的IP地址和端口&lt;/li&gt;
&lt;li&gt;输出文件格式：支持Cain&amp;amp;Abel或John the Ripper格式&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;设置模块选项后，执行&lt;code&gt;run&lt;/code&gt;命令启动服务器。SMB服务器将在后台监听，并在收到SMB哈希时报告并将其记录到指定的输出文件。&lt;/p&gt;
&lt;h2 id=&#34;修改快捷方式或收藏夹&#34;&gt;修改快捷方式或收藏夹
&lt;/h2&gt;&lt;p&gt;攻击者可以修改可写目录中的快捷方式或收藏夹，使用户连接到恶意服务器并传递哈希。例如，检查用户的收藏夹可能会发现类似以下内容：&lt;/p&gt;
&lt;p&gt;攻击者将正确的URL（如&lt;code&gt;http://www.bing.com&lt;/code&gt;）替换为攻击者的IP地址和适当协议（如&lt;code&gt;file://172.16.189.131/&lt;/code&gt;）。当目标用户执行修改后的快捷方式或收藏夹时，计算机会自动尝试与服务器进行挑战响应身份验证。&lt;/p&gt;
&lt;p&gt;Metasploit会在控制台显示这些尝试并将其记录到指定的输出文件。捕获的哈希可以传输到密码破解工具以恢复用户凭据。&lt;/p&gt;
&lt;h2 id=&#34;注意事项&#34;&gt;注意事项
&lt;/h2&gt;&lt;p&gt;修改后的快捷方式将无法正常工作，但这可能会被最终用户忽略。此外，修改后的文件可能会从执行认证漏洞扫描的扫描账户捕获凭据。如果扫描账户具有管理员权限且未使用强密码，可能会快速获得成功。&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
