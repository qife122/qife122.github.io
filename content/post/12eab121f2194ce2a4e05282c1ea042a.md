---
date: 2025-08-07T23:12:26+08:00
title: Intel EPT技术实现MMU虚拟化详解
tags: [虚拟化, EPT, 内存管理, 逆向工程]
authors: qife
description: 本系列文章深入讲解基于Intel EPT技术的MMU虚拟化实现，涵盖地址转换机制、页表结构、EPT违规处理等核心内容，并提供可集成到hypervisor项目中的完整实现方案。
---

# MMU Virtualization via Intel EPT - Index

## 概述
在收到大量请求后，我决定完成这个关于使用Intel EPT实现MMU虚拟化的5部分系列文章。本系列既可用于自主hypervisor开发，也可与之前发布的CPU虚拟化系列配套使用。文章将频繁引用先前项目内容（因多数读者会同步跟进），但实现方案在所有Type-2型hypervisor项目中都较为相似。本系列仅适用于支持虚拟化技术特性的Intel处理器用户，目标是让读者掌握分页机制、扩展页表(EPT)、多种地址转换机制的技术细节，并学会在虚拟化项目中实际应用。

完成本系列后，读者将拥有可工作的EPT基础框架，并能在未来项目中自主设计实现EPT基础设施。每篇文章都会像往常一样提供相关概念解析、重要性说明、详细参考资料链接，并在文末设置"推荐阅读"章节。部分VMX地址转换机制还会标注"必读"要求。



## 章节规划

### Part 0 - 技术基础
介绍扩展页表相关子课题，包括Intel EPT的设计动机、地址转换辅助机制、性能考量，以及分页结构中常见的缓存组件入门。

### Part 1 - 实现篇 - 结构体定义与初始化
提供预制结构体及其功能详解，这些结构将用于本系列主要EPT实现。同时详述VMX环境下EPT初始化与直通(passthrough)流程。完成本章后将具备可运行的EPT框架。

### Part 2 - 实现篇 - EPT辅助函数/页遍历/EPT违规与销毁
解析各类EPT引发的VM-exit及其处理方法，实现销毁函数集和Guest-Host地址转换辅助例程。读者将编写处理程序，学习EPT相关的配置错误、违规和异常类型。

### Part 3 - 集成测试
将EPT初始化函数集成到现有CPU虚拟化项目中，通过测试运行验证EPT正常工作，并主动触发违规来测试处理程序。

### Part 4 - EPTP切换与页钩子（附加章节）
作为安全研究特别内容，演示如何通过EPTP切换和页钩子来隐藏信息、挂钩受保护函数，或防止敏感信息被读取。案例包括：挂钩Windows内核函数以伪造代码完整性校验结果，以及防止应用程序读取受保护进程的内存空间。

## 特别说明
在阅读本系列前，强烈建议通读所有推荐资料并实践——如果你想真正精通虚拟化技术和微架构的话。这个提醒会在每篇文章重复出现，因为细节决定成败。各章节还会根据内容补充推特、博客等第三方资料（均会标明出处）。

特别感谢Aidan Khoury在合作项目中提供的深刻见解，他传授的诸多技巧将在本系列与读者分享。欢迎在评论区留下反馈、问题或建议。

*版权声明：本文采用Read Only许可协议，禁止未经授权的复制或使用*